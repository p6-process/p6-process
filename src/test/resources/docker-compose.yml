version: "2"

services:

  p6-etcd:
    image: bitnami/etcd:3.4.9
    environment:
      ALLOW_NONE_AUTHENTICATION: "yes"
    labels:
      - "test.Wait.forLogMessage.regex=.*ready to serve client requests.*\\s"
      - "test.Wait.forLogMessage.times=1"
      - "test.log=true"
      - "test.property.quarkus.grpc.clients.etcd.port=$${port:p6-etcd:2379}"
      - "test.property.quarkus.grpc.clients.etcd.host=$${host:p6-etcd}"
    ports:
      - "2379:2379"
    networks:
      - "test"

  p6-process:
    container_name: p6-process
    image: p6-process:latest
    ports:
      - "8080:8080"
    environment:
      QUARKUS_GRPC_CLIENTS_ETCD_PORT: 2379
      QUARKUS_GRPC_CLIENTS_ETCD_HOST: p6-etcd
    labels:
      - "test.unit=false"
      - "test.priority=101"
      - "test.image.pull=DEFAULT"
      - "test.property.quarkus.http.test-port=$${port:p6-process:8080}"
    volumes:
      - ./p6:/work/p6
    networks:
      - test

networks:
  test: